# 仕様 #2：AC → E2E 雛形生成（HITL 支援）

## 目的と価値
受け入れ基準（AC）をもとに、LLM で **Playwright 互換の E2E 雛形**を素早く作成。  
**要件定義の代替ではない**。人間レビュー（HITL）を前提に、初期たたきを短時間で得る。

## 入力・前提
- AC は「ユーザーストーリー」「前提」「シナリオ」「期待結果」を持つ。  
- セレクタ戦略・データ境界はテンプレートで指針を与える（`data-test-id` 推奨等）。

## 出力（データ契約）
- `generated.spec.ts`：テスト名、前提、ステップ、期待結果を E2E で実行可能な形に落とした**雛形**。  
- `junit.xml`：雛形実行時の通過/失敗を記録（HITL 後の回帰対象）。

## 受け入れ条件（AC）
- 生成物は**危険操作（削除/課金）を含まない**モック/スタブ前提。  
- テスト名・説明に**AC 由来の文言痕跡**を保持（トレーサビリティ）。  
- LLM 生成の**判断不確実性をコメントで可視化**（要レビュー箇所に `TODO:`）。

## 非機能要件
- 1 本の AC から、最大 3 パス（正常/境界/異常）の雛形を生成可能。
- LLM プロンプトはリポジトリでバージョン管理（再現性）。

## リスクと緩和
- セレクタ脆弱性 → `data-test-id` 導入／最小 DOM 依存。
- 生成の過信 → **HITL / PR レビュー**を必須と明記。

## 生成フロー
1. AC テンプレートを読み込み、ユーザーストーリーとシナリオを構造化データに展開。
2. LLM へ以下のコンテキストを投入：
   - UI モデル（モック）と推奨セレクタポリシー。
   - 既存の Playwright ヘルパー関数一覧。
   - レビューコメントの例（TODO の書き方）。
3. 正常・境界・異常の 3 パターンを並列プロンプトで生成し、相互矛盾を検査。
4. `TODO:` コメントとともに `generated.spec.ts` を出力し、HITL レビューを必須化。
5. 受け入れ後に JUnit レポートを CI に登録し、差分を追跡。

## HITL チェックリスト
- [ ] 危険操作が含まれていないか（削除・課金・メール送信）。
- [ ] `data-test-id` など安定セレクタを利用しているか。
- [ ] TODO コメントに対する回答（レビュワー判断）が記録されたか。
- [ ] 境界値や異常系のシナリオが AC に沿っているか。

## プロンプト管理のポイント
- プロンプトは `prompts/e2e/` に配置し、コミット履歴でトレース可能にする。
- モデル差異（GPT-4 / Claude など）ごとにテンプレを分離し、精度比較を記録。
- `prompt.json` に temperature, max_tokens, safety 設定を明示し、CI で使用する値を固定。
