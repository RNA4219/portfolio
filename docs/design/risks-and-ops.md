# リスク・運用

## 主なリスク
- **仕様の曖昧さ** → #1 で lint 的チェック、#2 では HITL を明示。
- **セレクタ脆弱性** → `data-test-id` 指針、CSS/XPath 回避。
- **LLM の不安定性** → 影実行 + 計測、段階的フォールバック。

### リスクマトリクス（例）
| リスク | 影響度 | 発生頻度 | 早期警戒シグナル | 対応策 |
| --- | --- | --- | --- | --- |
| 仕様テンプレ逸脱 | 中 | 高 | Lint エラー数の増加 | PR テンプレと自動チェックでブロック |
| flaky 爆発 | 高 | 中 | `stability_index` < 0.6 のケースが 5 件超 | 自動再実行 + ISSUE 起票 + 根本原因分析 |
| LLM コスト超過 | 中 | 低 | `cost_estimate` が週次予算を 10% 超過 | モデル切替 / キャッシュ導入 / 影実行頻度調整 |
| セキュリティ事故 | 高 | 低 | Dependabot Alert / CodeQL Alert | 即時パッチ適用 + 影響調査 + レトロスペクティブ |

## 運用ルール（例）
- 仕様テンプレ変更は PR で合意（破壊変更は要アナウンス）。
- #2 生成物は必ず人がレビュー（HITL）→ ラベル付与 `needs-hitl`.
- flaky の再現タスクは ISSUE 自動起票 → 期限/オーナ設定。

### インシデント対応フロー
1. CI Analyzer が重大フレーク（連続 3 失敗）を検知し、Slack / GitHub Issue に通知。
2. オンコール担当が 24 時間以内に暫定対処（再実行 or 無効化）を実施。
3. 72 時間以内にポストモーテムを作成し、根本原因と対策を共有。
4. 対策が完了したら KPI への影響を測定し、Lessons learned をドキュメントへ反映。

### オペレーションカレンダー
- **Weekly**：LLM metrics / flaky 集計のレビュー、改善タスクの優先度付け。
- **Bi-weekly**：仕様テンプレの見直し、Lint ルールのアップデート。
- **Quarterly**：コスト・ROI の評価、モデルやインフラの刷新計画を検討。

## 成功指標（KPI）
- テスト作成時間 **-30%** / 1 ヶ月
- flaky 率 **-20%** / 1 ヶ月
- カバレッジ **+15pt** / 1 ヶ月
- 影実行の**失敗分類可視化**（timeout/rate_limit/parse の割合）

### KPI ダッシュボード例
- **品質トラック**：カバレッジ推移、flaky 率、再実行成功率。
- **スピードトラック**：仕様→テスト生成のリードタイム、HITL レビュー所要時間。
- **コストトラック**：LLM コスト、CI 実行時間、Pages 配信コスト。
- **学習トラック**：インシデント件数、ポストモーテム完了率、改善施策の定着度。
